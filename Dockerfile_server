FROM ubuntu:20.04

# Set the working directory for the app
WORKDIR /opt/chat

# Install Java 11, x11vnc, and necessary packages
RUN apt-get update && apt-get install -y \
    openjdk-11-jre \
    x11vnc \
    xvfb \
    procps \
    openbox \
    curl \
    && rm -rf /var/lib/apt/lists/*

# Create necessary directories for VNC
RUN mkdir -p /root/.vnc /config/xdg/cache

# Ensure x11vnc is properly installed
RUN which x11vnc || (echo "x11vnc not installed!" && exit 1)

# Set up VNC password and create the VNC password file
RUN echo "password" | vncpasswd -f > /root/.vnc/passwd && \
    chmod 600 /root/.vnc/passwd

# Copy the chat files into the container
COPY ./chat /opt/chat

# Expose VNC and HTTP ports
EXPOSE 5801 5901

# Define the app startup script
COPY startapp_server.sh /opt/chat/startapp_server.sh
RUN chmod +x /opt/chat/startapp_server.sh

# Set the entrypoint to launch the app
ENTRYPOINT ["/opt/chat/startapp_server.sh"]
